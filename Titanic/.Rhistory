validation %>% filter(userId==214 & str_detect(title,'Star Wars')) %>% arrange(title)
# check in EDX
edx %>% group_by(movieId,title) %>% filter(movieId == 2628) %>% summarise(n())
#matrix[1:3,6:8]
#print(rec)
##names(getModel(rec))
#getModel(rec)$nn
#as(pre,"list")
matrix <- as(pre,"matrix")
df <- as(pre,"data.frame")
df %>% filter(user==214 & str_detect(item,'Star Wars')) %>% arrange(item)
validation %>% filter(userId==214 & str_detect(title,'Star Wars')) %>% arrange(title)
# check in EDX & validation
edx %>% group_by(movieId,title) %>% filter(movieId == 2628) %>% summarise(n())
validation %>% group_by(movieId,title) %>% filter(str_detect(item,'Star Wars: Episode II - Attack of the Clones (2002)')) %>% summarise(n())
#as(pre,"list")
matrix <- as(pre,"matrix")
df <- as(pre,"data.frame")
df %>% filter(user==214 & str_detect(item,'Star Wars')) %>% arrange(item)
validation %>% filter(userId==214 & str_detect(title,'Star Wars')) %>% arrange(title)
# check in EDX & validation
edx %>% group_by(movieId,title) %>% filter(movieId == 2628) %>% summarise(n())
validation %>% group_by(movieId,title) %>% filter(str_detect(title,'Star Wars: Episode II - Attack of the Clones (2002)')) %>% summarise(n())
#matrix[1:3,6:8]
#print(rec)
##names(getModel(rec))
#getModel(rec)$nn
#as(pre,"list")
matrix <- as(pre,"matrix")
df <- as(pre,"data.frame")
df %>% filter(user==214 & str_detect(item,'Star Wars')) %>% arrange(item)
validation %>% filter(userId==214 & str_detect(title,'Star Wars')) %>% arrange(title)
# check in EDX & validation
edx %>% group_by(movieId,title) %>% filter(movieId == 2628) %>% summarise(n())
validation %>% group_by(movieId,title) %>% filter(str_detect(title,'Star Wars')) %>% summarise(n())
#matrix[1:3,6:8]
#print(rec)
##names(getModel(rec))
#getModel(rec)$nn
matrix[1:10,1:10]
matrix[1:3,1:10]
y['182',1:10]
y[8:10,1:10]
# initial metrix
y[8:10,1:10]
df[1:3,1:10]
# initial metrix
y[8:10,1:10]
matrix[1:3,1:10]
colnames(y2)
a <- colnames(y2)
validation %>% group_by(title) %>% select(title)
validation %>% group_by(title) %>% select(title) %>% arrange(title)
validation %>% select(n_distinct(title))
validation %>% group_by(title) %>% summarise(n()) %>% arrange(title)
b <- validation %>% group_by(title) %>% summarise(n()) %>% arrange(title)
head(a)
colnames(a)
class(a)
match(a,b)
class(b)
match(a,b$title)
?match
match
a[8940]
b[8940]
b$title[8940]
a[8940]
a(8940)
class(a)
a[1]
length(a)
a[2]
b$title[4699]
c <- match(a,b$title)
c
is.na(c)
which(is.na(c))
str_detect(a,'Toy Story')
str_detect(b$title,'Toy Story')
str_detect(a,'Toy Story')
which(str_detect(a,'Toy Story'))
which(str_detect(b$title,'Toy Story'))
validation %>% filter(userId==182)
which(str_detect(a,'Clueless'))
which(str_detect(b$title,'Clueless'))
which(str_detect(colnames(y2),'Clueless'))
y2[,36]
myframe <- as(y2,"matrix")
which(str_detect(colnames(myframe),'Clueless'))
validation %>% filter(userId==182)
validation %>% filter(userId==182 & title=='Clueless (1995)')
which(str_detect(colnames(myframe),'Clueless'))
myframe['182',myindex]
myindex <- which(str_detect(colnames(myframe),'Clueless'))
myframe['182',myindex]
validation %>% filter(userId==182 & title=='Clueless (1995)')
validation %>% filter(userId==182 & rating==2)
myindex <- which(str_detect(colnames(myframe),'Flirting With Disaster'))
myframe['182',myindex]
myindex <- which(str_detect(colnames(myframe),'Instinct'))
myframe['182',myindex]
myindex <- which(str_detect(colnames(myframe),'Me, Myself and Irene'))
myframe['182',myindex]
validation %>% filter(userId==182 & rating==2)
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Flirting With Disaster'))
myframe['182',myindex]
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Truth About Charlie'))
myframe['182',myindex]
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Splendor'))
myframe['182',myindex]
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Flirting With Disaster'))
myframe['182',myindex]
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Truth About Charlie'))
myframe['182',myindex]
str_detect(colnames(myframe),'Truth About Charlie')
which(str_detect(colnames(myframe),'Truth About Charlie'))
which(str_detect(colnames(y),'Truth About Charlie'))
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Flirting with disaster'))
myframe['182',myindex]
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Flirting With Disaster'))
myframe['182',myindex]
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Truth About'))
myframe['182',myindex]
myindex <- which(str_detect(colnames(myframe),'Truth About'))
myindex
myfram[,467]
myframe['5787',467]
myframe[,467]
myframe[467]
myframe[,465:467]
myframe[1:5,465:467]
dim(myframe)
dim(myframe)
str(myframe)
df <- as(y2,"data.frame")
str(df)
df <- as(y2,"list")
str(df)
df <- as(y2,"matrix")
str(df)
class(df)
colnames(df) %>% head(20)
rownames(df) %>% head(20)
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- rownames(as(y2,"matrix"))
head(prediction)
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(user))
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(prediction$user))
str(prediction)
summary(prediction$id)
head(prediction)
head(prediction,25)
prediction%>% filter(user==182)
str(prediction)
str(validation)
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(prediction$user))
colnames(prediction) <- c('user','title','rating','userId')
str(prediction)
validation %>% group_by(userId,title) %>% left_join(prediction,by='userId') %>% left_join(prediction,by='title') %>% filter(userId==187)
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(prediction$user))
prediction$title <- as.character(prediction$title)
head(prediction)
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(prediction$user))
prediction$title <- as.character(prediction$item)
colnames(prediction) <- c('user','title','rating','userId')
str(prediction)
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(prediction$user))
prediction$title <- as.character(prediction$item)
colnames(prediction) <- c('user','item','rating','userId','title')
str(prediction)
validation %>% group_by(userId,title) %>% left_join(prediction,by='userId') %>% left_join(prediction,by='title') %>% filter(userId==187)
validation %>% group_by(userId,title) %>% left_join(prediction,by='userId') %>% filter(userId==187)
head(prediction)
validation %>% select(movieId==3086) %>% head(10)
validation %>% head(10)
validation %>% select(movieId==432) %>% head(10)
validation %>% filter(movieId==432) %>% head(10)
validation %>% filter(movieId==3086) %>% head(10)
with(movie_titles, title[match(colnames(y), movieId)])
head(movie_titles)
with(movie_titles, title[match(colnames(y2), title)])
head(validation)
head(df)
head(prediction)
#validation %>% group_by(userId) %>% left_join(prediction,by='userId') %>% filter(userId==187)
prediction$movieId <- with(movie_titles, movieId[match(prediction$title, title)])
#validation %>% group_by(userId) %>% left_join(prediction,by='userId') %>% filter(userId==187)
prediction$movieId <- with(movie_titles, movieId[match(prediction$title, title)])
head(prediction)
#validation %>% group_by(userId) %>% left_join(prediction,by='userId') %>% filter(userId==187)
prediction$movieId <- with(movie_titles, movieId[match(prediction$title, title)])
head(prediction)
prediction <- prediction %>% select(-user,-item)
#validation %>% group_by(userId) %>% left_join(prediction,by='userId') %>% filter(userId==187)
prediction$movieId <- with(movie_titles, movieId[match(prediction$title, title)])
head(prediction)
prediction <- prediction %>% select(-user,-item)
head(prediction)
prediction <- prediction %>% select(-rownames)
prediction[,-1]
prediction <- prediction[,-1]
head(prediction)
str(prediction)
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(prediction$user))
prediction$title <- as.character(prediction$item)
colnames(prediction) <- c('user','item','rating','userId','title')
prediction <- prediction %>% select(-user,-item)
prediction$movieId <- with(movie_titles, movieId[match(prediction$title, title)])
str(prediction)
head(prediction)
validation %>% left_join(prediction,by='userId') %>% left_join(prediction,by='movieId') %>% head(10)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% head(20)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==186)
prediction %>% filter(userId==186 & movieId==293)
myframe <- as(y2,"matrix")
myindex <- which(str_detect(colnames(myframe),'Flirting'))
myframe['182',myindex]
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125) %>% select(rating.y)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125) %>% select(rating.y)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125) %>% select(userId,movieId,rating.x,rating.y)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y, prediction)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y, prediction)
validation$final <- validation %>% left_join(prediction,by=c('userId','movieId')) %>% select(rating.y)
str(validation)
validation$final
validation$final %>% head(10)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% select(-final)
validation <- validation %>% select(-final)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y, prediction)
final <- validation %>% left_join(prediction,by=c('userId','movieId')) %>% .$rating.y
class(final)
#edx$prediction <- tmp$rating2
#validation$prediction[validation$prediction==3 & validation$rating==4] <- 4
#validation$prediction[validation$prediction==3.5 & validation$rating==4] <- 4
#validation$prediction[validation$prediction==4 & validation$rating==3] <- 3
#validation$prediction[validation$prediction==3 & validation$rating==2] <- 2
#validation$prediction[validation$prediction==3.5] <- 4
b <- factor(validation$rating)
a <- factor(final)
confusionMatrix(a,b)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y, prediction)
final <- validation %>% left_join(prediction,by=c('userId','movieId')) %>% .$rating.y
summary(b)
#edx$prediction <- tmp$rating2
#validation$prediction[validation$prediction==3 & validation$rating==4] <- 4
#validation$prediction[validation$prediction==3.5 & validation$rating==4] <- 4
#validation$prediction[validation$prediction==4 & validation$rating==3] <- 3
#validation$prediction[validation$prediction==3 & validation$rating==2] <- 2
#validation$prediction[validation$prediction==3.5] <- 4
b <- factor(validation$rating)
a <- factor(final)
confusionMatrix(b,a)
length(a)
length(b)
summary(a)
summary(b)
dim(y)
3132*3048
head(validation)
validation$final <- final
head(validation)
y2['231',]
y2[1:5,1:5]
y[1:5,1:5]
y['231',1:5]
y['8',1:5]
y['125',1:5]
head(validation)
head(validation)
validation %>% filter(userId==231)
head(validation)
validation %>% filter(userId %in% c(231,480,586)
head(validation)
validation %>% filter(userId %in% c(231,480,586))
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% summarise(count())
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% summarise(count())
head(validation)
validation %>% filter(userId %in% c(231,480,586))
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId)
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% summarise(count())
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(user_iD) %>% summarise(count())
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(useriD) %>% summarise(count())
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(userId) %>% summarise(count())
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(userId)
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(userId) %>% summarise(n = count(userId))
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(userId) %>% summarise(n = count())
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(userId) %>% summarise(n = length(userId))
train_small <- train %>%
group_by(movieId) %>%
filter(n() >= 5) %>% ungroup() %>%
group_by(userId) %>%
filter(n() >= 5) %>% ungroup()
y <- train_small %>%
select(userId, movieId, rating) %>%
spread(movieId, rating) %>%
as.matrix()
rownames(y)<- y[,1]
train_small <- train %>%
group_by(movieId) %>%
filter(n() >= 5 & n()<=49) %>% ungroup() %>%
group_by(userId) %>%
filter(n() >= 5 & n()<=49) %>% ungroup()
y <- train_small %>%
select(userId, movieId, rating) %>%
spread(movieId, rating) %>%
as.matrix()
rownames(y)<- y[,1]
y <- y[,-1]
movie_titles <- train %>%
select(movieId, title) %>%
distinct()
colnames(y) <- with(movie_titles, title[match(colnames(y), movieId)])
#y_test[is.na(y_test)] <- 0
#sds <- colSds(x)
#qplot(sds, bins = 4, color = I("black"))
library(recommenderlab)
y2 <- y
#y2[is.na(y2)] <- 0
y2 <- as(y2, "realRatingMatrix")
rec <- Recommender(y2, method = "POPULAR")
pre <- predict(rec, y2[8:10], type="ratings")
pre
as(pre, "matrix")[,1:18]
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(prediction$user))
prediction$title <- as.character(prediction$item)
colnames(prediction) <- c('user','item','rating','userId','title')
prediction <- prediction %>% select(-user,-item)
prediction$movieId <- with(movie_titles, movieId[match(prediction$title, title)])
str(prediction)
head(prediction)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==182 & movieId==125)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y, prediction)
final <- validation %>% left_join(prediction,by=c('userId','movieId')) %>% .$rating.y
#edx$prediction <- tmp$rating2
#validation$prediction[validation$prediction==3 & validation$rating==4] <- 4
#validation$prediction[validation$prediction==3.5 & validation$rating==4] <- 4
#validation$prediction[validation$prediction==4 & validation$rating==3] <- 3
#validation$prediction[validation$prediction==3 & validation$rating==2] <- 2
#validation$prediction[validation$prediction==3.5] <- 4
b <- factor(validation$rating)
a <- factor(final)
confusionMatrix(b,a)
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(userId) %>% summarise(n = length(userId))
validation$final <- final
validation$final <- final
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(userId) %>% summarise(n = length(userId))
y['480',1:10]
y[1:5,1:5]
head(train_small)
train_small <- edx %>%
group_by(movieId) %>%
filter(n() >= 5 & n()<=49) %>% ungroup() %>%
group_by(userId) %>%
filter(n() >= 5 & n()<=49) %>% ungroup()
train_small %>% filter(userId==480)
head(train_small)
edx %>% filter(userId==480)
train_small %>% filter(movieId==1) %>% head(20)
train_small %>% filter(movieId==1)
train_small <- edx %>%
group_by(movieId) %>%
filter(n() >= 30) %>% ungroup() %>%
group_by(userId) %>%
filter(n() >= 30) %>% ungroup()
train_small %>% filter(userId==480)
y <- train_small %>%
select(userId, movieId, rating) %>%
spread(movieId, rating) %>%
as.matrix()
rownames(y)<- y[,1]
y <- y[,-1]
movie_titles <- train %>%
select(movieId, title) %>%
distinct()
colnames(y) <- with(movie_titles, title[match(colnames(y), movieId)])
#y_test[is.na(y_test)] <- 0
#sds <- colSds(x)
#qplot(sds, bins = 4, color = I("black"))
library(recommenderlab)
y2 <- y
#y2[is.na(y2)] <- 0
y2 <- as(y2, "realRatingMatrix")
rec <- Recommender(y2, method = "POPULAR")
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
prediction <- as(y2,"data.frame")
prediction$id <- as.numeric(as.character(prediction$user))
prediction$title <- as.character(prediction$item)
colnames(prediction) <- c('user','item','rating','userId','title')
prediction <- prediction %>% select(-user,-item)
prediction$movieId <- with(movie_titles, movieId[match(prediction$title, title)])
str(prediction)
head(prediction)
validation$final <- final
head(validation)
validation %>% filter(userId %in% c(231,480,586)) %>% select(userId) %>% group_by(userId) %>% summarise(n = length(userId))
y['480',1]
y['480',1:5]
colnames(y,'Jurassic Park(1993)')
which(colnames(y,'Jurassic Park(1993)'))
myframe <- as(y2,"matrix")
str_detect(colnames(y),'Jurassic Park')
which(str_detect(colnames(y),'Jurassic Park'))
y[1:5,459,1372,4099]
y[1:5,459]
y[1:5,459:460]
y['480',459:460]
final
head(prediction)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==480 & movieId==459)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y, prediction)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% .$rating.y
head(prediction)
prediction %>% filter(userId==480 & movieId==459)
prediction %>% filter(userId==480)
prediction %>% filter(userId==480 & str_detect(title,'Jurassic Park'))
prediction %>% filter(userId==480 & movieId==480)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==480 & movieId==480)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==480 & movieId==480)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y, prediction)
final <- validation %>% left_join(prediction,by=c('userId','movieId')) %>% .$rating.y
head(prediction)
head(movie_titles)
movie_titles %>% filter(movieId==480)
edx %>% filter(movieId==480) %>% head(20)
validation %>% filter(movieId==480)
validation %>% filter(movieId==480 & userId==480)
edx %>% filter(userId==480)
myframe <- as(y2,"matrix")
head(prediction)
length(final)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==480 & movieId==480) ## something wrong with jurassic park... check later.
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(!is.na(rating.y)) %>% select(userId,movieId,rating.x,rating.y, prediction)
final <- validation %>% left_join(prediction,by=c('userId','movieId')) %>% .$rating.y
length(prediction)
prediction
DIM(PREDiction)
dim(prediction)
sum(!is.na(final))
sum(is.na(final))
final[1:5]
head(prediction)
head(prediction)
validation %>% left_join(prediction,by=c('userId','movieId')) %>% filter(userId==3 & movieId==110)
str(validation)
str(prediction)
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
# convert to datframe and tidyup user id to numeric
df <- as(y2,"matrix")
